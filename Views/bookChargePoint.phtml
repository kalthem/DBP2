<?php
// MUST be first - no whitespace before!
if (session_status() !== PHP_SESSION_ACTIVE) {
    session_start();
}

$baseUrl = 'http://20.126.5.244/~u202103011/BorrowMyCharger';
include __DIR__ . '/template/header.phtml';

$chargePointId = $_GET['id'] ?? ($_POST['charge_point_id'] ?? null);

if (!$chargePointId) {
    echo '<div class="alert alert-danger">Charge Point ID is missing.</div>';
    include __DIR__ . '/template/footer.phtml';
    exit;
}
?>

<!-- Custom Booking Form Styles -->
<link rel="stylesheet" href="<?= $baseUrl ?>/css/booking.css">
<!-- Client-side Validation Script -->
<script src="<?= $baseUrl ?>/js/booking.js" defer></script>

<div class="container booking-container">
    <h2 class="mb-4">Confirm Your Booking</h2>

    <?php if (!empty($_SESSION['booking_error'])): ?>
        <div id="formError" class="alert alert-danger">
            <?= htmlspecialchars($_SESSION['booking_error']) ?>
        </div>
        <?php unset($_SESSION['booking_error']); ?>
    <?php else: ?>
        <div id="formError"></div>
    <?php endif; ?>

    <form method="POST" action="<?= $baseUrl ?>/Controllers/BookingController.php" class="booking-form" id="bookingForm">
        <input type="hidden" name="charge_point_id" value="<?= htmlspecialchars($chargePointId) ?>">
        <input type="hidden" name="user_id" value="<?= $_SESSION['user']['id'] ?? '' ?>">

        <div class="mb-3">
            <label for="start_time" class="form-label">Start Time</label>
            <input type="datetime-local" class="form-control" id="start_time" name="start_time" required>
        </div>

        <div class="mb-3">
            <label for="end_time" class="form-label">End Time</label>
            <input type="datetime-local" class="form-control" id="end_time" name="end_time" required>
        </div>

        <div class="mb-3">
            <label for="message" class="form-label">Message to Homeowner</label>
            <textarea class="form-control" id="message" name="message" rows="4" placeholder="Include any specific instructions or questions."></textarea>
        </div>

        <div class="d-flex justify-content-between">
            <a href="<?= $baseUrl ?>/index.php?action=dashboard" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-success">Submit Booking</button>
        </div>
    </form>
</div>

<?php include __DIR__ . '/template/footer.phtml'; ?>
